<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Генератор PDF с вашим шаблоном</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }

    input[type="file"]::file-selector-button {
      background-color: #4f46e5;
      color: white;
      border: 1px solid #4f46e5;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    input[type="file"]::file-selector-button:hover {
      background-color: #4338ca;
    }
  </style>
</head>

<body class="bg-slate-100 flex items-center justify-center min-h-screen p-4">

  <div class="w-full max-w-2xl bg-white rounded-xl shadow-lg p-8 space-y-6">
    <div class="text-center">
      <h1 class="text-3xl font-bold text-slate-800">Генератор PDF-презентаций</h1>
      <p class="text-slate-500 mt-2">Заполните поля, чтобы создать PDF на основе вашего шаблона.</p>
    </div>

    <!-- Форма для ввода данных -->
    <div class="space-y-4">
      <div>
        <label for="propertyName" class="block text-sm font-medium text-slate-700">Название объекта
          (property_name)</label>
        <input type="text" id="propertyName" value="ELO 2 Damac Hills"
          class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
      </div>
      <div>
        <label for="backgroundUpload" class="block text-sm font-medium text-slate-700">Фоновое изображение
          (main_background)</label>
        <input type="file" id="backgroundUpload" accept="image/*"
          class="mt-1 block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
      </div>
      <div>
        <label for="companyLogoUpload" class="block text-sm font-medium text-slate-700">Логотип компании
          (company_logo)</label>
        <input type="file" id="companyLogoUpload" accept="image/*"
          class="mt-1 block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
      </div>
      <div>
        <label for="avatarUpload" class="block text-sm font-medium text-slate-700">Аватар агента (avatar_img)</label>
        <input type="file" id="avatarUpload" accept="image/*"
          class="mt-1 block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
      </div>
    </div>

    <!-- Кнопка генерации -->
    <button id="generatePdfBtn"
      class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200 flex items-center justify-center">
      <svg id="svg-icon" class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
      </svg>
      <svg id="spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg"
        fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor"
          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
        </path>
      </svg>
      <span id="button-text">Сгенерировать PDF</span>
    </button>
  </div>

  <!-- ВАШ ШАБЛОН ДЛЯ PDF (скрыт от пользователя) -->
  <template id="pdf-template">
    <div style="width: 297mm; height: 210mm; overflow: hidden;">
      <style>
        .render-body {
          font-family: 'Inter', sans-serif;
          width: 100%;
          height: 100%;
          overflow: hidden;
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }

        .barnes-container {
          width: 100%;
          height: 100%;
          background-image: linear-gradient(rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0) 23.981%),
          linear-gradient(rgba(0, 0, 0, 0.1) 38.75%, rgb(0, 0, 0) 100%),
          url('{{main_background}}');
          background-size: auto, auto, cover;
          background-position: 0% 0%, 0% 0%, 50% 50%;
          position: relative;
        }

        .main-content {
          width: 100%;
          height: 100%;
          position: relative;
        }

        .content-wrapper {
          display: flex;
          flex-direction: row;
          align-items: center;
          justify-content: space-between;
          padding: 52px 56px;
          width: 100%;
          height: 100%;
          gap: 20px;
        }

        .left-content {
          display: flex;
          flex: 1;
          flex-direction: column;
          gap: 16px;
          align-items: flex-start;
          justify-content: space-between;
          min-width: 0;
          color: #ffffff;
          height: 100%;
        }

        .header {
          display: flex;
          width: 100%;
        }

        .presentation-text {
          font-family: 'Inter', sans-serif;
          font-weight: 500;
          font-size: 20px;
          line-height: 1.5;
          color: #ffffff;
        }

        .main-text-section {
          display: flex;
          flex-direction: column;
          gap: 21px;
          align-items: flex-start;
          justify-content: flex-end;
          color: #ffffff;
          width: 100%;
        }

        .property-info {
          display: flex;
          flex-direction: column;
          gap: 6px;
          align-items: flex-start;
          justify-content: flex-end;
          width: 100%;
        }

        .look-text {
          font-family: 'Inter', sans-serif;
          font-weight: 400;
          font-size: 28px;
          line-height: 1.2;
          text-transform: lowercase;
          width: 100%;
        }

        .property-name {
          font-family: 'Inter', sans-serif;
          font-weight: 500;
          font-size: 72px;
          line-height: 1;
          width: 100%;
        }

        .creation-date {
          font-family: 'Inter', sans-serif;
          font-weight: 500;
          font-size: 20px;
          line-height: 1.5;
          opacity: 0.4;
          color: #ffffff;
          width: 100%;
        }

        .right-content {
          flex: 0 0 440px;
          height: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .agent-card {
          backdrop-filter: blur(30px);
          -webkit-backdrop-filter: blur(30px);
          background: rgba(255, 255, 255, 0.03);
          border: 1px solid rgba(255, 255, 255, 0.1);
          border-radius: 27px;
          width: 100%;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: flex-start;
          overflow: hidden;
        }

        .company-section {
          width: 100%;
          position: relative;
        }

        .company-bg {
          backdrop-filter: blur(30px);
          -webkit-backdrop-filter: blur(30px);
          background: #1b402b;
          border: 1px solid rgba(255, 255, 255, 0.1);
          border-radius: 24px 24px 0 0;
          height: 160px;
          width: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 20px;
        }

        .company-logo-img {
          max-width: 100%;
          max-height: 100%;
          width: 100%;
          height: 100%;
          object-fit: cover;
        }

        .agent-info-section {
          padding: 0 30px 30px 30px;
          width: 100%;
          margin-top: -60px;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: flex-end;
          gap: 20px;
        }

        .agent-photo {
          width: 120px;
          height: 120px;
          border-radius: 24px;
          overflow: hidden;
          border: 1px solid #f0f0f4;
          background: #ffffff;
          position: relative;
          z-index: 2;
        }

        .agent-photo img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }

        .agent-name-section {
          display: flex;
          flex-direction: column;
          gap: 5px;
          width: 100%;
          color: #ffffff;
          text-align: center;
        }

        .agent-name {
          font-family: 'Inter', sans-serif;
          font-weight: 500;
          font-size: 30px;
          line-height: 1;
          color: #ffffff;
        }

        .agent-title {
          font-family: 'Inter', sans-serif;
          font-weight: 400;
          font-size: 20px;
          line-height: 1;
          color: #ffffff;
          opacity: 0.6;
        }

        .verification-badges {
          display: flex;
          flex-direction: row;
          gap: 8px;
          align-items: center;
        }

        .verified-badge,
        .license-badge {
          display: flex;
          flex-direction: row;
          align-items: center;
          border: 1px solid rgba(255, 255, 255, 0.1);
          border-radius: 8px;
          overflow: hidden;
          padding: 0;
        }

        .verified-badge {
          background: rgba(0, 132, 255, 0.2);
        }

        .license-badge {
          background: rgba(0, 177, 32, 0.2);
        }

        .badge-icon {
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 10px;
          height: 40px;
        }

        .badge-text {
          font-family: 'Inter', sans-serif;
          font-weight: 500;
          font-size: 16px;
          color: #ffffff;
          padding: 10px;
          text-align: center;
          border-left: 1px solid rgba(255, 255, 255, 0.1);
        }

        .license-number {
          font-family: 'Inter', sans-serif;
          font-weight: 500;
          font-size: 16px;
          color: #ffffff;
          padding: 10px;
          text-align: center;
          border-left: 1px solid rgba(157, 255, 199, 0.19);
        }

        .contact-info {
          display: flex;
          flex-direction: column;
          gap: 10px;
          width: 100%;
        }

        .contact-item {
          display: flex;
          flex-direction: row;
          gap: 15px;
          align-items: center;
        }

        .contact-icon {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 40px;
          height: 40px;
          background: rgba(255, 255, 255, 0.15);
          border: 1px solid rgba(255, 255, 255, 0.1);
          border-radius: 8px;
          padding: 8px;
        }

        .contact-text {
          font-family: 'Inter', sans-serif;
          font-weight: 500;
          font-size: 18px;
          color: #ffffff;
        }

        .languages-section {
          display: flex;
          flex-direction: column;
          gap: 12px;
          width: 100%;
        }

        .languages-title {
          font-family: 'Inter', sans-serif;
          font-weight: 500;
          font-size: 20px;
          line-height: 1;
          opacity: 0.6;
          color: #ffffff;
          width: 100%;
        }

        .language-badges {
          display: flex;
          flex-direction: row;
          gap: 10px;
          align-items: center;
          width: 100%;
        }

        .language-badge {
          background: rgba(255, 255, 255, 0.15);
          border: 1px solid rgba(255, 255, 255, 0.1);
          border-radius: 8px;
          padding: 10px 14px;
          font-family: 'Inter', sans-serif;
          font-weight: 500;
          font-size: 16px;
          color: #ffffff;
        }
      </style>
      <div class="render-body">
        <div class="barnes-container">
          <div class="main-content">
            <div class="content-wrapper">
              <div class="left-content">
                <div class="header">
                  <div class="presentation-text">Presentation prepared by Luxary Real Estate</div>
                </div>
                <div class="main-text-section">
                  <div class="property-info">
                    <div class="look-text">Look what we find for you</div>
                    <div class="property-name">{{property_name}}</div>
                  </div>
                  <div class="creation-date">Date of creation 22.04.2025</div>
                </div>
              </div>
              <div class="right-content">
                <div class="agent-card">
                  <div class="company-section">
                    <div class="company-bg">
                      <img src="{{company_logo}}" alt="Company Logo" class="company-logo-img">
                    </div>
                  </div>
                  <div class="agent-info-section">
                    <div class="agent-photo">
                      <img src="{{avatar_img}}" alt="Agent Avatar" />
                    </div>
                    <div class="agent-name-section">
                      <div class="agent-name">Svetlana Frolova</div>
                      <div class="agent-title">Luxury Real Estate</div>
                    </div>
                    <div class="verification-badges">
                      <div class="verified-badge">
                        <div class="badge-icon">
                          <svg width="27" height="27" viewBox="0 0 27 27" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                              d="M13.162 0L16.314 2.42748L20.2779 2.08942L21.6171 5.83562L25.1346 7.69431L24.2358 11.5698L26.1901 15.0352L23.3387 17.8096L23.1092 21.7813L19.2105 22.5737L16.8702 25.7909L13.162 24.3497L9.45384 25.7909L7.11348 22.5737L3.21483 21.7813L2.98531 17.8096L0.13397 15.0352L2.08818 11.5698L1.18942 7.69431L4.7069 5.83562L6.04609 2.08942L10.0101 2.42748L13.162 0Z"
                              fill="#0085FF" />
                            <path d="M8.42423 13.1617L11.5831 16.3206L18.4274 9.47637" stroke="white"
                              stroke-width="2.6324" />
                          </svg>
                        </div>
                        <div class="badge-text">Verified</div>
                      </div>
                      <div class="license-badge">
                        <div class="badge-icon">
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                              d="M20 13.0004C20 18.0004 16.5 20.5005 12.34 21.9505C12.1222 22.0243 11.8855 22.0207 11.67 21.9405C7.5 20.5005 4 18.0004 4 13.0004V6.00045C4 5.73523 4.10536 5.48088 4.29289 5.29334C4.48043 5.10581 4.73478 5.00045 5 5.00045C7 5.00045 9.5 3.80045 11.24 2.28045C11.4519 2.09945 11.7214 2 12 2C12.2786 2 12.5481 2.09945 12.76 2.28045C14.51 3.81045 17 5.00045 19 5.00045C19.2652 5.00045 19.5196 5.10581 19.7071 5.29334C19.8946 5.48088 20 5.73523 20 6.00045V13.0004Z"
                              stroke="#00FF80" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M9 12L11 14L15 10" stroke="#00FF80" stroke-width="2" stroke-linecap="round"
                              stroke-linejoin="round" />
                          </svg>
                        </div>
                        <div class="badge-text">License</div>
                        <div class="license-number">№39426</div>
                      </div>
                    </div>
                    <div class="contact-info">
                      <div class="contact-item">
                        <div class="contact-icon"><svg width="28" height="28" viewBox="0 0 28 28" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                              d="M16.3914 2.33333C18.7694 2.5839 20.9906 3.6386 22.6878 5.32301C24.3849 7.00742 25.4563 9.22065 25.7248 11.5967M16.3914 7C17.5389 7.22626 18.5918 7.7922 19.4136 8.62436C20.2353 9.45652 20.788 10.5165 20.9998 11.6667M25.6666 19.7401V23.2401C25.6679 23.565 25.6014 23.8866 25.4712 24.1844C25.341 24.4821 25.1501 24.7493 24.9107 24.969C24.6713 25.1886 24.3886 25.3558 24.0808 25.4599C23.773 25.564 23.4469 25.6027 23.1233 25.5734C19.5332 25.1834 16.0848 23.9566 13.0549 21.9918C10.2361 20.2006 7.84615 17.8106 6.05492 14.9918C4.08323 11.9482 2.85621 8.48294 2.47326 4.87678C2.4441 4.55416 2.48244 4.229 2.58584 3.92201C2.68924 3.61502 2.85542 3.33292 3.07382 3.09367C3.29221 2.85442 3.55803 2.66327 3.85434 2.53239C4.15066 2.4015 4.47099 2.33375 4.79492 2.33345H8.29492C8.86111 2.32787 9.41001 2.52837 9.83931 2.89757C10.2686 3.26676 10.549 3.77947 10.6283 4.34011C10.776 5.46019 11.0499 6.55996 11.4449 7.61845C11.6019 8.03602 11.6359 8.48985 11.5428 8.92614C11.4498 9.36243 11.2336 9.76291 10.9199 10.0801L9.43826 11.5618C11.0991 14.4826 13.5175 16.901 16.4383 18.5618L17.9199 17.0801C18.2371 16.7664 18.6376 16.5503 19.0739 16.4572C19.5102 16.3642 19.964 16.3981 20.3816 16.5551C21.4401 16.9501 22.5398 17.2241 23.6599 17.3718C24.2266 17.4517 24.7442 17.7372 25.1142 18.1739C25.4842 18.6105 25.6808 19.168 25.6666 19.7401Z"
                              stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                          </svg></div>
                        <div class="contact-text">+971 50 355 44 22</div>
                      </div>
                      <div class="contact-item">
                        <div class="contact-icon"><svg width="28" height="28" viewBox="0 0 28 28" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                              d="M25.6667 8.16667L15.2017 14.8167C14.8415 15.0423 14.425 15.162 14 15.162C13.575 15.162 13.1585 15.0423 12.7983 14.8167L2.33333 8.16667M4.66667 4.66667H23.3333C24.622 4.66667 25.6667 5.71134 25.6667 7V21C25.6667 22.2887 24.622 23.3333 23.3333 23.3333H4.66667C3.378 23.3333 2.33333 22.2887 2.33333 21V7C2.33333 5.71134 3.378 4.66667 4.66667 4.66667Z"
                              stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                          </svg></div>
                        <div class="contact-text">s.frolova@fiduproperties.ae</div>
                      </div>
                      <div class="contact-item">
                        <div class="contact-icon"><svg width="28" height="28" viewBox="0 0 28 28" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                              d="M25.6667 14C25.6667 20.4433 20.4433 25.6667 14 25.6667M25.6667 14C25.6667 7.55668 20.4433 2.33333 14 2.33333M25.6667 14H2.33333M14 25.6667C7.55668 25.6667 2.33333 20.4433 2.33333 14M14 25.6667C11.0043 22.5212 9.33333 18.3438 9.33333 14C9.33333 9.6562 11.0043 5.47885 14 2.33333M14 25.6667C16.9957 22.5212 18.6667 18.3438 18.6667 14C18.6667 9.6562 16.9957 5.47885 14 2.33333M2.33333 14C2.33333 7.55668 7.55668 2.33333 14 2.33333"
                              stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                          </svg></div>
                        <div class="contact-text">fiduproperties.ae</div>
                      </div>
                    </div>
                    <div class="languages-section">
                      <div class="languages-title">Languages</div>
                      <div class="language-badges">
                        <div class="language-badge">English</div>
                        <div class="language-badge">Russian</div>
                        <div class="language-badge">Spanish</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </template>

  <script>
    const generatePdfBtn = document.getElementById('generatePdfBtn');
    const propertyNameInput = document.getElementById('propertyName');
    const companyLogoInput = document.getElementById('companyLogoUpload');
    const avatarInput = document.getElementById('avatarUpload');
    const backgroundInput = document.getElementById('backgroundUpload');
    const pdfTemplate = document.getElementById('pdf-template');

    const readFileAsBase64 = (file) => {
      return new Promise((resolve, reject) => {
        if (!file) { resolve(null); return; }
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
        reader.readAsDataURL(file);
      });
    };

    generatePdfBtn.addEventListener('click', async () => {
      const spinner = document.getElementById('spinner');
      const buttonText = document.getElementById('button-text');
      const svgIcon = document.getElementById('svg-icon');
      spinner.classList.remove('hidden');
      svgIcon.classList.add('hidden');
      buttonText.textContent = 'Генерация...';
      generatePdfBtn.disabled = true;

      try {
        let htmlContent = pdfTemplate.innerHTML;
        const propertyName = propertyNameInput.value;

        const [companyLogo, avatar, background] = await Promise.all([
          readFileAsBase64(companyLogoInput.files[0]),
          readFileAsBase64(avatarInput.files[0]),
          readFileAsBase64(backgroundInput.files[0])
        ]);

        // Заглушки, если изображения не выбраны
        const defaultBg = 'https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=1920&h=1080&fit=crop&crop=center';
        const defaultLogo = 'https://i.ibb.co/7jR3Y1V/luxury-logo.png';
        const defaultAvatar = 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=400&h=400&fit=crop&crop=face';

        htmlContent = htmlContent.replace('{{property_name}}', propertyName || 'Не указано');
        htmlContent = htmlContent.replace(`url('{{main_background}}')`, `url('${background || defaultBg}')`);
        htmlContent = htmlContent.replace('{{company_logo}}', companyLogo || defaultLogo);
        htmlContent = htmlContent.replace('{{avatar_img}}', avatar || defaultAvatar);

        const opt = {
          margin: 0,
          filename: `presentation-${propertyName.replace(/\s+/g, '-')}.pdf`,
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 3, useCORS: true, allowTaint: true, logging: false },
          jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
        };

        const element = document.createElement('div');
        element.innerHTML = htmlContent;

        await document.fonts.ready;

        await html2pdf().set(opt).from(element.firstElementChild).save();

      } catch (error) {
        console.error('Ошибка при генерации PDF:', error);
        alert('Произошла ошибка. Пожалуйста, проверьте консоль.');
      } finally {
        spinner.classList.add('hidden');
        svgIcon.classList.remove('hidden');
        buttonText.textContent = 'Сгенерировать PDF';
        generatePdfBtn.disabled = false;
      }
    });
  </script>
</body>

</html>