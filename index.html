<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Генератор PDF с вашим шаблоном</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="all-templates.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }

    input[type="file"]::file-selector-button {
      background-color: #4f46e5;
      color: white;
      border: 1px solid #4f46e5;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    input[type="file"]::file-selector-button:hover {
      background-color: #4338ca;
    }

    .input {
      width: 100%;
      padding: 8px 12px;
      border-radius: 0.375rem;
      border: 1px solid #d1d5db;
    }

    .file-input {
      font-size: 0.875rem;
    }
  </style>
</head>

<body class="bg-slate-100 flex items-center justify-center min-h-screen p-4">

  <div class="w-full max-w-3xl bg-white rounded-xl shadow-lg p-8">
    <div class="text-center mb-6">
      <h1 class="text-3xl font-bold text-slate-800">Генератор PDF-презентаций</h1>
      <p class="text-slate-500 mt-2">Заполните поля, чтобы создать PDF на основе вашего шаблона.</p>
    </div>

    <!-- Форма для ввода данных -->
    <div class="space-y-6 max-h-[60vh] overflow-y-auto pr-4">
      <!-- Общие данные -->
      <fieldset class="border-t pt-4">
        <legend class="text-lg font-semibold text-slate-700 mb-2">Общие данные</legend>
        <div class="space-y-4">
          <div>
            <label for="propertyName" class="block text-sm font-medium text-slate-700">Название объекта</label>
            <input type="text" id="propertyName" value="ELO 2 Damac Hills" class="mt-1 block w-full input">
          </div>
        </div>
      </fieldset>

      <!-- Страница 1 -->
      <fieldset class="border-t pt-4">
        <legend class="text-lg font-semibold text-slate-700 mb-2">Страница 1</legend>
        <div class="space-y-4">
          <div><label for="backgroundUpload" class="block text-sm font-medium text-slate-700">Фоновое
              изображение</label><input type="file" id="backgroundUpload" accept="image/*"
              class="mt-1 block w-full file-input"></div>
          <div><label for="companyLogoUpload" class="block text-sm font-medium text-slate-700">Логотип
              компании</label><input type="file" id="companyLogoUpload" accept="image/*"
              class="mt-1 block w-full file-input"></div>
          <div><label for="avatarUpload" class="block text-sm font-medium text-slate-700">Аватар агента</label><input
              type="file" id="avatarUpload" accept="image/*" class="mt-1 block w-full file-input"></div>
          <div><label for="presentationText" class="block text-sm font-medium text-slate-700">Текст в
              шапке</label><input type="text" id="presentationText" value="Presentation prepared by Luxary Real Estate"
              class="mt-1 block w-full input"></div>
          <div><label for="lookText" class="block text-sm font-medium text-slate-700">Подзаголовок</label><input
              type="text" id="lookText" value="Look what we find for you" class="mt-1 block w-full input"></div>
          <div><label for="creationDate" class="block text-sm font-medium text-slate-700">Дата создания</label><input
              type="text" id="creationDate" value="Date of creation 22.04.2025" class="mt-1 block w-full input"></div>
          <div><label for="agentName" class="block text-sm font-medium text-slate-700">Имя агента</label><input
              type="text" id="agentName" value="Svetlana Frolova" class="mt-1 block w-full input"></div>
          <div><label for="agentTitle" class="block text-sm font-medium text-slate-700">Должность агента</label><input
              type="text" id="agentTitle" value="Luxury Real Estate" class="mt-1 block w-full input"></div>
          <div><label for="agentPhone" class="block text-sm font-medium text-slate-700">Телефон</label><input
              type="text" id="agentPhone" value="+971 50 355 44 22" class="mt-1 block w-full input"></div>
          <div><label for="agentEmail" class="block text-sm font-medium text-slate-700">Email</label><input type="text"
              id="agentEmail" value="s.frolova@fiduproperties.ae" class="mt-1 block w-full input"></div>
          <div><label for="agentWebsite" class="block text-sm font-medium text-slate-700">Веб-сайт</label><input
              type="text" id="agentWebsite" value="fiduproperties.ae" class="mt-1 block w-full input"></div>
        </div>
      </fieldset>

      <!-- Страница 2 -->
      <fieldset class="border-t pt-4">
        <legend class="text-lg font-semibold text-slate-700 mb-2">Страница 2</legend>
        <div class="space-y-4">
          <div><label for="developerLogo" class="block text-sm font-medium text-slate-700">Логотип
              застройщика</label><input type="file" id="developerLogo" accept="image/*"
              class="mt-1 block w-full file-input"></div>
          <div><label for="projectImageP2" class="block text-sm font-medium text-slate-700">Изображение
              проекта</label><input type="file" id="projectImageP2" accept="image/*"
              class="mt-1 block w-full file-input"></div>
          <div><label for="developerName" class="block text-sm font-medium text-slate-700">Имя застройщика</label><input
              type="text" id="developerName" value="Damac Properties" class="mt-1 block w-full input"></div>
          <div><label for="districtName" class="block text-sm font-medium text-slate-700">Район</label><input
              type="text" id="districtName" value="Damac Hills, Dubai" class="mt-1 block w-full input"></div>
          <div><label for="timelineStartDate" class="block text-sm font-medium text-slate-700">Дата начала</label><input
              type="text" id="timelineStartDate" value="Q4 2024" class="mt-1 block w-full input"></div>
          <div><label for="timelineEndDate" class="block text-sm font-medium text-slate-700">Дата сдачи</label><input
              type="text" id="timelineEndDate" value="Q1 2026" class="mt-1 block w-full input"></div>
          <div><label for="timelineProgressText" class="block text-sm font-medium text-slate-700">Текст о ходе
              работ</label><input type="text" id="timelineProgressText"
              value="Up to 15 months left to expected handover" class="mt-1 block w-full input"></div>
        </div>
      </fieldset>

      <!-- Страница 3 -->
      <fieldset class="border-t pt-4">
        <legend class="text-lg font-semibold text-slate-700 mb-2">Страница 3</legend>
        <div class="space-y-4">
          <div><label for="buildingImageP3" class="block text-sm font-medium text-slate-700">Изображение
              здания</label><input type="file" id="buildingImageP3" accept="image/*"
              class="mt-1 block w-full file-input"></div>
          <div><label for="descriptionText" class="block text-sm font-medium text-slate-700">Описание</label><textarea
              id="descriptionText" class="mt-1 block w-full input"
              rows="4">Welcome to Damac Elo 2 and 3, an exceptional addition to the dynamic DAMAC Hills 2 community, promising to redefine modern living with its contemporary architecture and innovative amenities. Situated amidst the bustling energy of DAMAC Hills 2, ELO 2 and 3 emerges as a beacon of elevated lifestyles, offering residents an extraordinary living experience unlike any other.</textarea>
          </div>
        </div>
      </fieldset>

      <!-- Страница 4 (Typical Units) -->
      <fieldset class="border-t pt-4">
        <legend class="text-lg font-semibold text-slate-700 mb-2">Страница 4 (Типы юнитов)</legend>
        <div class="space-y-4">
          <div><label for="unitStudioCount" class="block text-sm font-medium text-slate-700">Кол-во студий</label><input
              type="text" id="unitStudioCount" value="239" class="mt-1 block w-full input"></div>
          <div><label for="unit1BedCount" class="block text-sm font-medium text-slate-700">Кол-во 1-комн.</label><input
              type="text" id="unit1BedCount" value="59" class="mt-1 block w-full input"></div>
          <div><label for="unit2BedCount" class="block text-sm font-medium text-slate-700">Кол-во 2-комн.</label><input
              type="text" id="unit2BedCount" value="64" class="mt-1 block w-full input"></div>
          <div><label for="villa4BedImage" class="block text-sm font-medium text-slate-700">Изображение Villa
              4</label><input type="file" id="villa4BedImage" accept="image/*" class="mt-1 block w-full file-input">
          </div>
          <div><label for="villa4BedPriceFrom" class="block text-sm font-medium text-slate-700">Villa 4 Цена
              от</label><input type="text" id="villa4BedPriceFrom" value="AED 610,000" class="mt-1 block w-full input">
          </div>
          <div><label for="villa4BedPriceTo" class="block text-sm font-medium text-slate-700">Villa 4 Цена
              до</label><input type="text" id="villa4BedPriceTo" value="AED 610,000" class="mt-1 block w-full input">
          </div>
          <div><label for="villa4BedAreaFrom" class="block text-sm font-medium text-slate-700">Villa 4 Площадь
              от</label><input type="text" id="villa4BedAreaFrom" value="160.6 m2" class="mt-1 block w-full input">
          </div>
          <div><label for="villa4BedAreaTo" class="block text-sm font-medium text-slate-700">Villa 4 Площадь
              до</label><input type="text" id="villa4BedAreaTo" value="160.6 m2" class="mt-1 block w-full input"></div>
          <div><label for="villa4BedRateFrom" class="block text-sm font-medium text-slate-700">Villa 4 Ставка
              от</label><input type="text" id="villa4BedRateFrom" value="AED 6,000/m2" class="mt-1 block w-full input">
          </div>
          <div><label for="villa4BedRateTo" class="block text-sm font-medium text-slate-700">Villa 4 Ставка
              до</label><input type="text" id="villa4BedRateTo" value="AED 9,000/m2" class="mt-1 block w-full input">
          </div>
          <div><label for="villa5BedImage" class="block text-sm font-medium text-slate-700">Изображение Villa
              5</label><input type="file" id="villa5BedImage" accept="image/*" class="mt-1 block w-full file-input">
          </div>
          <div><label for="villa5BedPriceFrom" class="block text-sm font-medium text-slate-700">Villa 5 Цена
              от</label><input type="text" id="villa5BedPriceFrom" value="AED 610,000" class="mt-1 block w-full input">
          </div>
          <div><label for="villa5BedPriceTo" class="block text-sm font-medium text-slate-700">Villa 5 Цена
              до</label><input type="text" id="villa5BedPriceTo" value="AED 610,000" class="mt-1 block w-full input">
          </div>
          <div><label for="villa5BedAreaFrom" class="block text-sm font-medium text-slate-700">Villa 5 Площадь
              от</label><input type="text" id="villa5BedAreaFrom" value="160.6 m2" class="mt-1 block w-full input">
          </div>
          <div><label for="villa5BedAreaTo" class="block text-sm font-medium text-slate-700">Villa 5 Площадь
              до</label><input type="text" id="villa5BedAreaTo" value="160.6 m2" class="mt-1 block w-full input"></div>
          <div><label for="villa5BedRateFrom" class="block text-sm font-medium text-slate-700">Villa 5 Ставка
              от</label><input type="text" id="villa5BedRateFrom" value="AED 6,000/m2" class="mt-1 block w-full input">
          </div>
          <div><label for="villa5BedRateTo" class="block text-sm font-medium text-slate-700">Villa 5 Ставка
              до</label><input type="text" id="villa5BedRateTo" value="AED 9,000/m2" class="mt-1 block w-full input">
          </div>
        </div>
      </fieldset>

      <!-- Страница 5 (Payment Plan) -->
      <fieldset class="border-t pt-4">
        <legend class="text-lg font-semibold text-slate-700 mb-2">Страница 5 (План оплаты)</legend>
        <div class="space-y-4">
          <div><label for="totalPrice" class="block text-sm font-medium text-slate-700">Общая цена</label><input
              type="text" id="totalPrice" value="AED 500,000" class="mt-1 block w-full input"></div>
          <div><label for="downPaymentPercent" class="block text-sm font-medium text-slate-700">Down Payment
              %</label><input type="text" id="downPaymentPercent" value="10%" class="mt-1 block w-full input"></div>
          <div><label for="downPaymentValue" class="block text-sm font-medium text-slate-700">Down Payment</label><input
              type="text" id="downPaymentValue" value="AED 100,000" class="mt-1 block w-full input"></div>
          <div><label for="onBookingValue" class="block text-sm font-medium text-slate-700">On Booking</label><input
              type="text" id="onBookingValue" value="AED 20,000" class="mt-1 block w-full input"></div>
          <div><label for="adminFeeValue" class="block text-sm font-medium text-slate-700">Administrative
              fee</label><input type="text" id="adminFeeValue" value="AED 20,000" class="mt-1 block w-full input"></div>
          <div><label for="dldFeePercent" class="block text-sm font-medium text-slate-700">DLD Fee %</label><input
              type="text" id="dldFeePercent" value="4%" class="mt-1 block w-full input"></div>
          <div><label for="dldFeeValue" class="block text-sm font-medium text-slate-700">DLD Fee</label><input
              type="text" id="dldFeeValue" value="AED 20,000" class="mt-1 block w-full input"></div>
          <div><label for="duringConstructionPercent" class="block text-sm font-medium text-slate-700">During
              construction %</label><input type="text" id="duringConstructionPercent" value="30%"
              class="mt-1 block w-full input"></div>
          <div><label for="duringConstructionValue" class="block text-sm font-medium text-slate-700">During
              construction</label><input type="text" id="duringConstructionValue" value="AED 100,000"
              class="mt-1 block w-full input"></div>
          <div><label for="onHandoverPercent" class="block text-sm font-medium text-slate-700">On Handover
              %</label><input type="text" id="onHandoverPercent" value="60%" class="mt-1 block w-full input"></div>
          <div><label for="onHandoverValue" class="block text-sm font-medium text-slate-700">On Handover</label><input
              type="text" id="onHandoverValue" value="AED 100,000" class="mt-1 block w-full input"></div>
          <div><label for="postHandoverPercent" class="block text-sm font-medium text-slate-700">Post Handover
              %</label><input type="text" id="postHandoverPercent" value="60%" class="mt-1 block w-full input"></div>
          <div><label for="postHandoverValue" class="block text-sm font-medium text-slate-700">Post
              Handover</label><input type="text" id="postHandoverValue" value="AED 100,000"
              class="mt-1 block w-full input"></div>
        </div>
      </fieldset>

      <!-- Страница 6 -->
      <fieldset class="border-t pt-4">
        <legend class="text-lg font-semibold text-slate-700 mb-2">Страница 6 (Полное изображение)</legend>
        <div class="space-y-4">
          <div><label for="fullImageP6" class="block text-sm font-medium text-slate-700">Изображение</label><input
              type="file" id="fullImageP6" accept="image/*" class="mt-1 block w-full file-input"></div>
        </div>
      </fieldset>

      <!-- Страница 7 -->
      <fieldset class="border-t pt-4">
        <legend class="text-lg font-semibold text-slate-700 mb-2">Страница 7 (Коллаж из 2)</legend>
        <div class="space-y-4">
          <div><label for="collage2Image1P7" class="block text-sm font-medium text-slate-700">Изображение
              1</label><input type="file" id="collage2Image1P7" accept="image/*" class="mt-1 block w-full file-input">
          </div>
          <div><label for="collage2Image2P7" class="block text-sm font-medium text-slate-700">Изображение
              2</label><input type="file" id="collage2Image2P7" accept="image/*" class="mt-1 block w-full file-input">
          </div>
        </div>
      </fieldset>

      <!-- Страница 8 -->
      <fieldset class="border-t pt-4">
        <legend class="text-lg font-semibold text-slate-700 mb-2">Страница 8 (Полное изображение)</legend>
        <div class="space-y-4">
          <div><label for="fullImageP8" class="block text-sm font-medium text-slate-700">Изображение</label><input
              type="file" id="fullImageP8" accept="image/*" class="mt-1 block w-full file-input"></div>
        </div>
      </fieldset>

      <!-- Страница 9 -->
      <fieldset class="border-t pt-4">
        <legend class="text-lg font-semibold text-slate-700 mb-2">Страница 9 (Коллаж из 3)</legend>
        <div class="space-y-4">
          <div><label for="collage3Image1P9" class="block text-sm font-medium text-slate-700">Изображение 1
              (большое)</label><input type="file" id="collage3Image1P9" accept="image/*"
              class="mt-1 block w-full file-input"></div>
          <div><label for="collage3Image2P9" class="block text-sm font-medium text-slate-700">Изображение 2
              (маленькое)</label><input type="file" id="collage3Image2P9" accept="image/*"
              class="mt-1 block w-full file-input"></div>
          <div><label for="collage3Image3P9" class="block text-sm font-medium text-slate-700">Изображение 3
              (маленькое)</label><input type="file" id="collage3Image3P9" accept="image/*"
              class="mt-1 block w-full file-input"></div>
        </div>
      </fieldset>

      <!-- Страница 10 -->
      <fieldset class="border-t pt-4">
        <legend class="text-lg font-semibold text-slate-700 mb-2">Страница 10 (Полное изображение)</legend>
        <div class="space-y-4">
          <div><label for="fullImageP10" class="block text-sm font-medium text-slate-700">Изображение</label><input
              type="file" id="fullImageP10" accept="image/*" class="mt-1 block w-full file-input"></div>
        </div>
      </fieldset>

      <!-- Страница 11 -->
      <fieldset class="border-t pt-4">
        <legend class="text-lg font-semibold text-slate-700 mb-2">Страница 11 (Застройщик)</legend>
        <div class="space-y-4">
          <div><label for="devCompanyImage" class="block text-sm font-medium text-slate-700">Изображение
              компании</label><input type="file" id="devCompanyImage" accept="image/*"
              class="mt-1 block w-full file-input"></div>
          <div><label for="devCompanyLogo" class="block text-sm font-medium text-slate-700">Логотип
              компании</label><input type="file" id="devCompanyLogo" accept="image/*"
              class="mt-1 block w-full file-input"></div>
          <div><label for="devFoundationYear" class="block text-sm font-medium text-slate-700">Год
              основания</label><input type="text" id="devFoundationYear" value="2002" class="mt-1 block w-full input">
          </div>
          <div><label for="devProjectsInProgress" class="block text-sm font-medium text-slate-700">Проектов в
              строке</label><input type="text" id="devProjectsInProgress" value="24" class="mt-1 block w-full input">
          </div>
          <div><label for="devCompletedProjects" class="block text-sm font-medium text-slate-700">Завершено
              проектов</label><input type="text" id="devCompletedProjects" value="61" class="mt-1 block w-full input">
          </div>
          <div><label for="devDescription" class="block text-sm font-medium text-slate-700">Описание
              застройщика</label><textarea id="devDescription" class="mt-1 block w-full input"
              rows="4">DAMAC Properties is part of DAMAC Group that has been shaping the Middle East's luxury real estate market since 1982, delivering iconic residential, commercial and leisure properties across the region and beyond...</textarea>
          </div>
        </div>
      </fieldset>
    </div>

    <!-- Кнопки управления -->
    <div class="mt-6 space-y-3">
      <button id="generatePdfBtn"
        class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200 flex items-center justify-center">
        <svg id="svg-icon-main" class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
        </svg>
        <svg id="spinner-main" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden"
          xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
          </path>
        </svg>
        <span id="button-text-main">Сгенерировать PDF</span>
      </button>
      <div class="grid grid-cols-5 gap-2">
        <button id="previewPage1Btn"
          class="w-full bg-slate-500 text-white font-bold py-2 px-2 rounded-lg hover:bg-slate-600 text-sm">Стр.
          1</button>
        <button id="previewPage2Btn"
          class="w-full bg-slate-500 text-white font-bold py-2 px-2 rounded-lg hover:bg-slate-600 text-sm">Стр.
          2</button>
        <button id="previewPage3Btn"
          class="w-full bg-slate-500 text-white font-bold py-2 px-2 rounded-lg hover:bg-slate-600 text-sm">Стр.
          3</button>
        <button id="previewPage4Btn"
          class="w-full bg-slate-500 text-white font-bold py-2 px-2 rounded-lg hover:bg-slate-600 text-sm">Стр.
          4</button>
        <button id="previewPage5Btn"
          class="w-full bg-slate-500 text-white font-bold py-2 px-2 rounded-lg hover:bg-slate-600 text-sm">Стр.
          5</button>
        <button id="previewPage6Btn"
          class="w-full bg-slate-500 text-white font-bold py-2 px-2 rounded-lg hover:bg-slate-600 text-sm">Стр.
          6</button>
        <button id="previewPage7Btn"
          class="w-full bg-slate-500 text-white font-bold py-2 px-2 rounded-lg hover:bg-slate-600 text-sm">Стр.
          7</button>
        <button id="previewPage8Btn"
          class="w-full bg-slate-500 text-white font-bold py-2 px-2 rounded-lg hover:bg-slate-600 text-sm">Стр.
          8</button>
        <button id="previewPage9Btn"
          class="w-full bg-slate-500 text-white font-bold py-2 px-2 rounded-lg hover:bg-slate-600 text-sm">Стр.
          9</button>
        <button id="previewPage10Btn"
          class="w-full bg-slate-500 text-white font-bold py-2 px-2 rounded-lg hover:bg-slate-600 text-sm">Стр.
          10</button>
        <button id="previewPage11Btn"
          class="w-full bg-slate-500 text-white font-bold py-2 px-2 rounded-lg hover:bg-slate-600 text-sm">Стр.
          11</button>
      </div>

    </div>
  </div>


  <script>
    // Getting all form elements
    const formElements = {
      propertyName: document.getElementById('propertyName'),
      backgroundUpload: document.getElementById('backgroundUpload'),
      companyLogoUpload: document.getElementById('companyLogoUpload'),
      avatarUpload: document.getElementById('avatarUpload'),
      presentationText: document.getElementById('presentationText'),
      lookText: document.getElementById('lookText'),
      creationDate: document.getElementById('creationDate'),
      agentName: document.getElementById('agentName'),
      agentTitle: document.getElementById('agentTitle'),
      agentPhone: document.getElementById('agentPhone'),
      agentEmail: document.getElementById('agentEmail'),
      agentWebsite: document.getElementById('agentWebsite'),
      developerLogo: document.getElementById('developerLogo'),
      projectImageP2: document.getElementById('projectImageP2'),
      developerName: document.getElementById('developerName'),
      districtName: document.getElementById('districtName'),
      timelineStartDate: document.getElementById('timelineStartDate'),
      timelineEndDate: document.getElementById('timelineEndDate'),
      timelineProgressText: document.getElementById('timelineProgressText'),
      buildingImageP3: document.getElementById('buildingImageP3'),
      descriptionText: document.getElementById('descriptionText'),
      unitStudioCount: document.getElementById('unitStudioCount'),
      unit1BedCount: document.getElementById('unit1BedCount'),
      unit2BedCount: document.getElementById('unit2BedCount'),
      villa4BedImage: document.getElementById('villa4BedImage'),
      villa4BedPriceFrom: document.getElementById('villa4BedPriceFrom'),
      villa4BedPriceTo: document.getElementById('villa4BedPriceTo'),
      villa4BedAreaFrom: document.getElementById('villa4BedAreaFrom'),
      villa4BedAreaTo: document.getElementById('villa4BedAreaTo'),
      villa4BedRateFrom: document.getElementById('villa4BedRateFrom'),
      villa4BedRateTo: document.getElementById('villa4BedRateTo'),
      villa5BedImage: document.getElementById('villa5BedImage'),
      villa5BedPriceFrom: document.getElementById('villa5BedPriceFrom'),
      villa5BedPriceTo: document.getElementById('villa5BedPriceTo'),
      villa5BedAreaFrom: document.getElementById('villa5BedAreaFrom'),
      villa5BedAreaTo: document.getElementById('villa5BedAreaTo'),
      villa5BedRateFrom: document.getElementById('villa5BedRateFrom'),
      villa5BedRateTo: document.getElementById('villa5BedRateTo'),
      totalPrice: document.getElementById('totalPrice'),
      downPaymentPercent: document.getElementById('downPaymentPercent'),
      downPaymentValue: document.getElementById('downPaymentValue'),
      onBookingValue: document.getElementById('onBookingValue'),
      adminFeeValue: document.getElementById('adminFeeValue'),
      dldFeePercent: document.getElementById('dldFeePercent'),
      dldFeeValue: document.getElementById('dldFeeValue'),
      duringConstructionPercent: document.getElementById('duringConstructionPercent'),
      duringConstructionValue: document.getElementById('duringConstructionValue'),
      onHandoverPercent: document.getElementById('onHandoverPercent'),
      onHandoverValue: document.getElementById('onHandoverValue'),
      postHandoverPercent: document.getElementById('postHandoverPercent'),
      postHandoverValue: document.getElementById('postHandoverValue'),
      fullImageP6: document.getElementById('fullImageP6'),
      collage2Image1P7: document.getElementById('collage2Image1P7'),
      collage2Image2P7: document.getElementById('collage2Image2P7'),
      fullImageP8: document.getElementById('fullImageP8'),
      collage3Image1P9: document.getElementById('collage3Image1P9'),
      collage3Image2P9: document.getElementById('collage3Image2P9'),
      collage3Image3P9: document.getElementById('collage3Image3P9'),
      fullImageP10: document.getElementById('fullImageP10'),
      devCompanyImage: document.getElementById('devCompanyImage'),
      devCompanyLogo: document.getElementById('devCompanyLogo'),
      devFoundationYear: document.getElementById('devFoundationYear'),
      devProjectsInProgress: document.getElementById('devProjectsInProgress'),
      devCompletedProjects: document.getElementById('devCompletedProjects'),
      devDescription: document.getElementById('devDescription'),
    };

    const generatePdfBtn = document.getElementById('generatePdfBtn');
    const templates = {
      page1: (window.PDF_TEMPLATES && window.PDF_TEMPLATES.page1) || '',
      page2: (window.PDF_TEMPLATES && window.PDF_TEMPLATES.page2) || '',
      page3: (window.PDF_TEMPLATES && window.PDF_TEMPLATES.page3) || '',
      page4: (window.PDF_TEMPLATES && window.PDF_TEMPLATES.page4) || '',
      page5: (window.PDF_TEMPLATES && window.PDF_TEMPLATES.page5) || '',
      page6: (window.PDF_TEMPLATES && window.PDF_TEMPLATES.page6) || '',
      page7: (window.PDF_TEMPLATES && window.PDF_TEMPLATES.page7) || '',
      page8: (window.PDF_TEMPLATES && window.PDF_TEMPLATES.page8) || '',
      page9: (window.PDF_TEMPLATES && window.PDF_TEMPLATES.page9) || '',
      page10: (window.PDF_TEMPLATES && window.PDF_TEMPLATES.page10) || '',
      page11: (window.PDF_TEMPLATES && window.PDF_TEMPLATES.page11) || ''
    };

    for (let i = 1; i <= 11; i++) {
      const btn = document.getElementById(`previewPage${i}Btn`);
      if (btn) {
        btn.addEventListener('click', () => previewPage(templates[`page${i}`]));
      }
    }

    const readFileAsBase64 = (file) => {
      return new Promise((resolve) => {
        if (!file) { resolve(null); return; }
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = (error) => {
          console.error("FileReader error:", error);
          resolve(null);
        };
        reader.readAsDataURL(file);
      });
    };

    async function getFormData() {
      const data = {};
      for (const key in formElements) {
        if (formElements[key] && formElements[key].type === 'file') {
          data[key] = await readFileAsBase64(formElements[key].files[0]);
        } else if (formElements[key]) {
          data[key] = formElements[key].value;
        }
      }
      return data;
    }

    function replacePlaceholders(html, data) {
      const defaults = {
        backgroundUpload: 'https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=1920&h=1080&fit=crop&crop=center',
        companyLogoUpload: 'https://i.ibb.co/7jR3Y1V/luxury-logo.png',
        avatarUpload: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=400&h=400&fit=crop&crop=face',
        developerLogo: 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=80&h=80&fit=crop&crop=center',
        projectImageP2: 'https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=800&h=1000&fit=crop&crop=center',
        buildingImageP3: 'https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=800&h=1200&fit=crop&crop=center',
        villa4BedImage: 'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=600&h=600&fit=crop&crop=center',
        villa5BedImage: 'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=600&h=600&fit=crop&crop=center',
        fullImageP6: 'https://images.unsplash.com/photo-1580587771525-78b9dba3b914?q=80&w=1974&auto=format&fit=crop',
        collage2Image1P7: 'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=2070&auto=format&fit=crop',
        collage2Image2P7: 'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?q=80&w=2070&auto=format&fit=crop',
        fullImageP8: 'https://images.unsplash.com/photo-1598228723793-52759bba239c?q=80&w=1974&auto=format&fit=crop',
        collage3Image1P9: 'https://images.unsplash.com/photo-1582268611958-ebfd161ef9cf?q=80&w=2070&auto=format&fit=crop',
        collage3Image2P9: 'https://images.unsplash.com/photo-1605276374104-5de67d216b8a?q=80&w=2070&auto=format&fit=crop',
        collage3Image3P9: 'https://images.unsplash.com/photo-1605146769289-440113cc3d00?q=80&w=2070&auto=format&fit=crop',
        fullImageP10: 'https://images.unsplash.com/photo-1570129477492-45c003edd2be?q=80&w=2070&auto=format&fit=crop',
        devCompanyImage: 'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=800&h=600&fit=crop&crop=center',
        devCompanyLogo: 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=128&h=128&fit=crop&crop=center',
      };

      const replacements = {
        '{{property_name}}': data.propertyName, '{{main_background}}': data.backgroundUpload || defaults.backgroundUpload,
        '{{company_logo}}': data.companyLogoUpload || defaults.companyLogoUpload, '{{avatar_img}}': data.avatarUpload || defaults.avatarUpload,
        '{{presentation_text}}': data.presentationText, '{{look_text}}': data.lookText, '{{creation_date}}': data.creationDate,
        '{{agent_name}}': data.agentName, '{{agent_title}}': data.agentTitle, '{{agent_phone}}': data.agentPhone,
        '{{agent_email}}': data.agentEmail, '{{agent_website}}': data.agentWebsite,
        '{{project_title_p2}}': data.propertyName, '{{developer_logo}}': data.developerLogo || defaults.developerLogo,
        '{{developer_name}}': data.developerName, '{{district_name}}': data.districtName,
        '{{timeline_start_date}}': data.timelineStartDate, '{{timeline_end_date}}': data.timelineEndDate,
        '{{timeline_progress_text}}': data.timelineProgressText, '{{project_image_p2}}': data.projectImageP2 || defaults.projectImageP2,
        '{{building_image_p3}}': data.buildingImageP3 || defaults.buildingImageP3,
        '{{project_title_p3}}': data.propertyName, '{{developer_logo_p3}}': data.developerLogo || defaults.developerLogo,
        '{{developer_name_p3}}': data.developerName, '{{description_text}}': data.descriptionText,
        '{{unit_studio_count}}': data.unitStudioCount, '{{unit_1_bed_count}}': data.unit1BedCount, '{{unit_2_bed_count}}': data.unit2BedCount,
        '{{villa_4_bed_image}}': data.villa4BedImage || defaults.villa4BedImage, '{{villa_4_bed_price_from}}': data.villa4BedPriceFrom, '{{villa_4_bed_price_to}}': data.villa4BedPriceTo,
        '{{villa_4_bed_area_from}}': data.villa4BedAreaFrom, '{{villa_4_bed_area_to}}': data.villa4BedAreaTo, '{{villa_4_bed_rate_from}}': data.villa4BedRateFrom, '{{villa_4_bed_rate_to}}': data.villa4BedRateTo,
        '{{villa_5_bed_image}}': data.villa5BedImage || defaults.villa5BedImage, '{{villa_5_bed_price_from}}': data.villa5BedPriceFrom, '{{villa_5_bed_price_to}}': data.villa5BedPriceTo,
        '{{villa_5_bed_area_from}}': data.villa5BedAreaFrom, '{{villa_5_bed_area_to}}': data.villa5BedAreaTo, '{{villa_5_bed_rate_from}}': data.villa5BedRateFrom, '{{villa_5_bed_rate_to}}': data.villa5BedRateTo,
        '{{total_price}}': data.totalPrice, '{{down_payment_percent}}': data.downPaymentPercent, '{{down_payment_value}}': data.downPaymentValue,
        '{{on_booking_value}}': data.onBookingValue, '{{admin_fee_value}}': data.adminFeeValue,
        '{{dld_fee_percent}}': data.dldFeePercent, '{{dld_fee_value}}': data.dldFeeValue,
        '{{during_construction_percent}}': data.duringConstructionPercent, '{{during_construction_value}}': data.duringConstructionValue,
        '{{on_handover_percent}}': data.onHandoverPercent, '{{on_handover_value}}': data.onHandoverValue,
        '{{post_handover_percent}}': data.postHandoverPercent, '{{post_handover_value}}': data.postHandoverValue,
        '{{full_image_p6}}': data.fullImageP6 || defaults.fullImageP6,
        '{{collage2_image1_p7}}': data.collage2Image1P7 || defaults.collage2Image1P7,
        '{{collage2_image2_p7}}': data.collage2Image2P7 || defaults.collage2Image2P7,
        '{{full_image_p8}}': data.fullImageP8 || defaults.fullImageP8,
        '{{collage3_image1_p9}}': data.collage3Image1P9 || defaults.collage3Image1P9,
        '{{collage3_image2_p9}}': data.collage3Image2P9 || defaults.collage3Image2P9,
        '{{collage3_image3_p9}}': data.collage3Image3P9 || defaults.collage3Image3P9,
        '{{full_image_p10}}': data.fullImageP10 || defaults.fullImageP10,
        '{{dev_company_image}}': data.devCompanyImage || defaults.devCompanyImage,
        '{{dev_company_logo}}': data.devCompanyLogo || defaults.devCompanyLogo,
        '{{dev_foundation_year}}': data.devFoundationYear, '{{dev_projects_in_progress}}': data.devProjectsInProgress,
        '{{dev_completed_projects}}': data.devCompletedProjects, '{{dev_description}}': data.devDescription,
      };

      let result = html;
      for (const [placeholder, value] of Object.entries(replacements)) {
        if (placeholder.includes('background') || placeholder.includes('image')) {
          result = result.replace(new RegExp(`url\\('${placeholder}'\\)`, 'g'), `url('${value}')`);
        }
        result = result.replace(new RegExp(placeholder, 'g'), value);
      }
      return result;
    }

    async function previewPage(templateHtml) {
      if (!templateHtml) { alert('Шаблон страницы недоступен.'); return; }
      const data = await getFormData();
      const html = replacePlaceholders(templateHtml, data);
      const newWindow = window.open();
      newWindow.document.write(html);
      newWindow.document.close();
    }

    generatePdfBtn.addEventListener('click', async () => {
      const spinner = document.getElementById('spinner-main');
      const buttonText = document.getElementById('button-text-main');
      const svgIcon = document.getElementById('svg-icon-main');
      spinner.classList.remove('hidden');
      svgIcon.classList.add('hidden');
      buttonText.textContent = 'Генерация...';
      generatePdfBtn.disabled = true;

      try {
        const data = await getFormData();
        let finalHtml = '';
        for (const key in templates) {
          const tpl = templates[key];
          if (typeof tpl === 'string' && tpl.length > 0) {
            finalHtml += replacePlaceholders(tpl, data);
          }
        }

        const element = document.createElement('div');
        element.innerHTML = finalHtml;

        const opt = {
          margin: 0,
          filename: `presentation-${data.propertyName.replace(/\s+/g, '-')}.pdf`,
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 3, useCORS: true, allowTaint: true, logging: false },
          jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
        };

        await document.fonts.ready;
        await html2pdf().set(opt).from(element).save();

      } catch (error) {
        console.error('Ошибка при генерации PDF:', error);
        alert('Произошла ошибка. Пожалуйста, проверьте консоль.');
      } finally {
        spinner.classList.add('hidden');
        svgIcon.classList.remove('hidden');
        buttonText.textContent = 'Сгенерировать PDF';
        generatePdfBtn.disabled = false;
      }
    });
  </script>
</body>

</html>